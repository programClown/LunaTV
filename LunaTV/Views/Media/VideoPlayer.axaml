<UserControl
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d"
    x:Class="LunaTV.Views.Media.VideoPlayer"
    x:DataType="vmm:VideoPlayerViewModel"
    xmlns="https://github.com/avaloniaui"
    xmlns:converters="clr-namespace:LunaTV.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:fa="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vlc="clr-namespace:LibVLCSharp.Avalonia;assembly=LibVLCSharp.Avalonia"
    xmlns:vmm="using:LunaTV.ViewModels.Media"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:tvShowPages="clr-namespace:LunaTV.ViewModels.TVShowPages"
    xmlns:tvMedia="clr-namespace:LunaTV.ViewModels.Media">

    <UserControl.Resources>
        <converters:TimeSpanToMinutesSecondsConverter x:Key="TimeSpanToMinutesSecondsConverter" />
    </UserControl.Resources>

    <Grid RowDefinitions="Auto, *">

        <TextBlock
            Grid.Row="0"
            HorizontalAlignment="Center"
            Padding="0,5,0,5"
            Text="{Binding VideoName}"
            VerticalAlignment="Top" />

        <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
            <vlc:VideoView
                Grid.Column="0"
                HorizontalAlignment="Stretch"
                MediaPlayer="{Binding MediaPlayer}"
                PointerEntered="VideoViewOnPointerEntered"
                VerticalAlignment="Stretch">

                <Border
                    IsVisible="False"
                    Margin="20"
                    Name="ControlsPanel">
                    <Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Bottom">
                        <StackPanel Grid.Column="0" Orientation="Horizontal">

                            <Button
                                Command="{Binding PreviousCommand}"
                                IsVisible="{Binding IsMultiVideos}"
                                Theme="{DynamicResource BorderlessButton}">
                                <fa:SymbolIcon FontSize="18" Symbol="PreviousFilled" />
                            </Button>
                            <Button Command="{Binding PlayCommand}" Theme="{DynamicResource BorderlessButton}">
                                <fa:SymbolIcon FontSize="32" Symbol="{Binding PlayIcon}" />
                            </Button>
                            <Button
                                Command="{Binding NextCommand}"
                                IsVisible="{Binding IsMultiVideos}"
                                Theme="{DynamicResource BorderlessButton}">
                                <fa:SymbolIcon FontSize="18" Symbol="NextFilled" />
                            </Button>
                            <Button Command="{Binding Stop}" Theme="{DynamicResource BorderlessButton}">
                                <fa:SymbolIcon FontSize="18" Symbol="StopFilled" />
                            </Button>

                        </StackPanel>

                        <Grid
                            ColumnDefinitions="60,*,60"
                            Grid.Column="1"
                            Margin="40,0">
                            <!--  Current Position Display  -->
                            <TextBlock
                                Grid.Column="0"
                                HorizontalAlignment="Left"
                                Text="{Binding SeekPosition, Converter={StaticResource TimeSpanToMinutesSecondsConverter}}"
                                VerticalAlignment="Center" />

                            <!--  Seek Slider  -->
                            <Slider
                                Grid.Column="1"
                                IsHitTestVisible="{Binding CanInteractSeekSlider}"
                                Margin="10,0"
                                Maximum="{Binding MaximumSeekValue}"
                                Minimum="0"
                                Value="{Binding SeekPosition, Mode=TwoWay}"
                                VerticalAlignment="Center" />

                            <!--  Maximum Duration Display  -->
                            <TextBlock
                                Grid.Column="2"
                                HorizontalAlignment="Right"
                                Text="{Binding MaximumSeekValue, Converter={StaticResource TimeSpanToMinutesSecondsConverter}}"
                                VerticalAlignment="Center" />
                        </Grid>

                        <StackPanel Grid.Column="2" Orientation="Horizontal">

                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock Text="倍速" VerticalAlignment="Center" />
                                <ComboBox ItemsSource="{Binding RateLists}" SelectedItem="{Binding SelectRate}" />
                            </StackPanel>

                            <Button
                                Background="Transparent"
                                Command="{Binding MuteCommand}"
                                Margin="10,0">
                                <fa:SymbolIcon FontSize="18" Symbol="{Binding MuteIcon}" />
                            </Button>

                            <Slider
                                IsEnabled="{Binding !IsMuted}"
                                Margin="0,0,20,0"
                                Maximum="1"
                                Minimum="0"
                                Value="{Binding Volume, Mode=TwoWay}"
                                VerticalAlignment="Center"
                                Width="150" />

                            <ToggleButton
                                Background="Transparent"
                                Classes="Tertiary"
                                IsChecked="{Binding IsVideosKanbanChecked}"
                                Margin="10,0">
                                <PathIcon
                                    FontSize="10"
                                    Data="{DynamicResource SemiIconKanban}" />
                            </ToggleButton>

                        </StackPanel>
                    </Grid>

                </Border>
            </vlc:VideoView>

            <Border Grid.Column="1"
                    Width="{Binding KanBanWidth}">
                <Grid RowDefinitions="Auto,*">
                    <TextBlock
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        FontSize="18"
                        FontWeight="ExtraBold"
                        IsHitTestVisible="False"
                        Text="{Binding VideoName}">
                        <TextBlock.Foreground>
                            <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                <GradientStop Offset="0" Color="#FF6094EA" />
                                <GradientStop Offset="1" Color="#FFF02FC2" />
                            </LinearGradientBrush>
                        </TextBlock.Foreground>
                        <TextBlock.Effect>
                            <DropShadowEffect Opacity="0.1" Color="Black" />
                        </TextBlock.Effect>
                    </TextBlock>

                    <ScrollViewer Grid.Row="1" Margin="4">
                        <ItemsControl HorizontalAlignment="Left" ItemsSource="{Binding Episodes}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="tvShowPages:EpisodeSubjectItem">

                                    <Button
                                        Width="100"
                                        Margin="0,4"
                                        Padding="0"
                                        Classes="EpisodeCard"
                                        Command="{Binding $parent[UserControl].((tvMedia:VideoPlayerViewModel)DataContext).KanbanSelectCommand}"
                                        CommandParameter="{Binding}">
                                        <Button.Styles>
                                            <Style Selector="Button.EpisodeCard:pointerover">
                                                <Setter Property="RenderTransform" Value="scale(1.05,1.05)" />
                                            </Style>
                                        </Button.Styles>
                                        <TextBlock Classes.Warning="{Binding Watched}" Text="{Binding Name}">
                                            <TextBlock.Styles>
                                                <Style Selector="TextBlock.Warning">
                                                    <Setter Property="ToolTip.Tip" Value="已经看过" />
                                                </Style>
                                            </TextBlock.Styles>
                                        </TextBlock>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel ItemSpacing="8" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>

        </Grid>


    </Grid>
</UserControl>