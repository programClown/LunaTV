<UserControl
    x:Class="LunaTV.Views.PlaygroundView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:nodify="https://miroiu.github.io/nodify"
    xmlns:playground="clr-namespace:Nodify.Playground;assembly=Nodify.Playground"
    xmlns:vm="clr-namespace:LunaTV.ViewModels"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:DataType="vm:PlaygroundViewModel"
    mc:Ignorable="d">

    <Grid>
        <nodify:NodifyEditor
            x:Name="EditorView"
            CanSelectMultipleConnections="True"
            CanSelectMultipleItems="True"
            Connections="{Binding Connections}"
            EnableRealtimeSelection="True"
            ItemsSource="{Binding Nodes}"
            MaxViewportZoom="10.0"
            MinViewportZoom="0.1"
            PendingConnection="{Binding PendingConnection}"
            SelectedConnection="{Binding SelectedConnection}"
            SelectedConnections="{Binding SelectedConnections}"
            SelectedItem="{Binding SelectedNode}"
            SelectedItems="{Binding SelectedNodes}"
            ViewportLocation="{Binding Location.Value}"
            ViewportSize="{Binding ViewportSize, Mode=OneWayToSource}"
            ViewportZoom="{Binding Zoom}">
            <nodify:NodifyEditor.Resources />
            <nodify:NodifyEditor.DataTemplates>
                <DataTemplate DataType="{x:Type playground:KnotNodeViewModel}">
                    <nodify:KnotNode Content="{Binding Connector}" />
                </DataTemplate>

                <DataTemplate DataType="{x:Type playground:CommentNodeViewModel}">
                    <nodify:GroupingNode
                        ActualSize="{Binding Size}"
                        Header="{Binding Title}"
                        MovementMode="{Binding $parent[UserControl].((vm:PlaygroundViewModel)DataContext).GroupingNodeMovement}" />
                </DataTemplate>


                <DataTemplate DataType="{x:Type playground:FlowNodeViewModel}">
                    <nodify:Node
                        Header="{Binding Title}"
                        Input="{Binding Input}"
                        Output="{Binding Output}" />
                </DataTemplate>

            </nodify:NodifyEditor.DataTemplates>


        </nodify:NodifyEditor>

        <Grid ZIndex="-2">
            <nodify:Minimap
                Width="300"
                Height="200"
                Margin="5,40"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                IsReadOnly="True"
                IsVisible="True"
                ItemsSource="{Binding ItemsSource, ElementName=EditorView}"
                MaxViewportOffset="{Binding MinimapViewportOffset.Size}"
                ResizeToViewport="{Binding ResizeToViewport}"
                ViewportLocation="{Binding ViewportLocation, ElementName=EditorView}"
                ViewportSize="{Binding ViewportSize, ElementName=EditorView}">
                <nodify:Minimap.ItemTemplate>
                    <DataTemplate DataType="{x:Type playground:NodeViewModel}">
                        <Grid />
                    </DataTemplate>
                </nodify:Minimap.ItemTemplate>
                <nodify:Minimap.ItemContainerTheme>
                    <ControlTheme BasedOn="{StaticResource {x:Type nodify:MinimapItem}}" TargetType="{x:Type nodify:MinimapItem}">
                        <Setter Property="Location" Value="{Binding Location}" />
                        <Setter Property="Width" Value="150" />
                        <Setter Property="Height" Value="130" />
                    </ControlTheme>
                </nodify:Minimap.ItemContainerTheme>
            </nodify:Minimap>
        </Grid>

        <Border
            Margin="20,0,0,20"
            HorizontalAlignment="Left"
            VerticalAlignment="Center">
            <StackPanel Spacing="8">
                <Button HorizontalAlignment="Left" Command="{Binding ImageNodeCommand}">图片节点</Button>
                <Button HorizontalAlignment="Left" Command="{Binding AlgorithmNodeCommand}">算法节点</Button>
                <Button HorizontalAlignment="Left" Command="{Binding DisplayNodeCommand}">显示节点</Button>
            </StackPanel>
        </Border>

        <Border
            Margin="20,0,0,20"
            HorizontalAlignment="Left"
            VerticalAlignment="Bottom"
            Background="#1e293b"
            CornerRadius="3">
            <Border.Effect>
                <DropShadowDirectionEffect ShadowDepth="1" />
            </Border.Effect>

            <StackPanel>
                <StackPanel.Resources />

                <Button Command="{x:Static nodify:EditorCommands.ZoomIn}">
                    <PathIcon
                        Classes="Small"
                        Data="{DynamicResource SemiIconPlus}"
                        Theme="{DynamicResource InnerPathIcon}" />
                </Button>

                <Button Command="{x:Static nodify:EditorCommands.ZoomOut}">
                    <PathIcon
                        Classes="Small"
                        Data="{DynamicResource SemiIconMinus}"
                        Theme="{DynamicResource InnerPathIcon}" />
                </Button>

                <Button Command="{x:Static nodify:EditorCommands.FitToScreen}">
                    <PathIcon
                        Classes="Small"
                        Data="{DynamicResource SemiIconMaximize}"
                        Theme="{DynamicResource InnerPathIcon}" />
                </Button>

                <Button>
                    <PathIcon
                        Classes="Small"
                        Data="{DynamicResource SemiIconLock}"
                        Theme="{DynamicResource InnerPathIcon}" />
                </Button>
            </StackPanel>
        </Border>
    </Grid>

</UserControl>